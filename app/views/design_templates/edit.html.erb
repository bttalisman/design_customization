<h1>Edit Template</h1>



<form action='update' id='design_template_form'>

  <div class='container' style='width:100%;'>

    <div style='flex:1;'>
      <div class='form-group'>
        <label for="template_name">Name</label>
        <input type='text' id='template_name' value='<%= @design_template.name %>'></input>
      </div>

      <a class='btn btn-default' href='<%= get_local_host %>/force_process?id=<%= @design_template.id %>'>Force Processing</a>
      <button class='btn btn-default' onclick='update_template( <%= @design_template.id %> ); return false;'>Update</button>
      <a class='btn btn-default' href='<%= get_local_host %>/design_templates/<%= @design_template.id %>'>Cancel</a>

      <a class="btn btn-default" href="/design_templates/<%= @design_template.id %>" data-confirm="Are you sure?" data-method="delete" rel="nofollow">Delete</a>



    </div>

    <div id='panel_container' style='flex:1;' ></div>

  </div>

  <input name='panel_data' id='tags_data' style='display:none;'></input>


</form>




<script>

  // This function is called when the user clicks save.  Data from the form
  // is gathered and posted to the design_template controller.
  function update_template( templateId )
  {

    var extractedSettings = build_template_settings();
    var oToSend = {};

    // We stuff our own data in there too
    var oGeneralSettings = {};
    oGeneralSettings[ 'template_name' ] = $('#template_name').val();

    oToSend['extracted_settings'] = extractedSettings;
    oToSend['general_settings'] = oGeneralSettings;

    var uri = '<%= get_local_host %>' + "/design_templates/" + templateId + "/tag_settings/";

    $.ajax({
                url: uri,
                type: 'post',
                dataType: 'application/json',
                data: JSON.stringify( oToSend ),
                success: function (data) {
                  alert( 'success getting : ' + data );
                },
                error: function(xhr, status, error) {
                  // todo - why never success?
                }
            });

    window.location = 'http://localhost:3000'

  }


  function getTemplateHTML( templateId )
  {
    var o;
    var uri;

    // If both of these arrays have no elements, then either the file contained
    // nothing to extract, or there is no file.
<%  if (@images.length == 0) && (@tags.length == 0) then %>
      $('#panel_container').html( '<b>This Illustrator file is not a template.</b>' );
      return;
<%  end %>



    uri = '<%= get_local_host %>' + '/partials/extracted_settings/' + templateId

    $.get( uri, function(data, status)
      {
          $('#panel_container').html( data );
      } );
  }



  $(document).ready(function(){
    getTemplateHTML( <%= @design_template.id %> );
  });



</script>
