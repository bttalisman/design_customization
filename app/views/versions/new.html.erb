
<script>


function create_version()
{

    alert( 'new.html.erb - create_version() - about to submit.');

    var oReturn = build();
    alert( 'oReturn: ' + JSON.stringify( oReturn ) );


    $('#version_data').attr( 'value', JSON.stringify( oReturn ) );


    var $pathInput = $('#version_output_folder_path');
    var userSpecFolder = $pathInput.val();

    if( userSpecFolder != '' )
    {
      // now we're gonna sneak in and append the beginning to this path
      var fullPath = '<%= @root_folder %>' + '/' + userSpecFolder;
      // and make sure it ends with a '/'
      var c = fullPath.slice(-1);
      if( c != '/' )
      {
        fullPath = fullPath + '/';
      }
      $pathInput.val( fullPath );
    }

    var form = $('#version_form');
    form.submit();
}

function validate()
{
  alert( 'validate()' );

  // todo - validate stuff
  return true;
}

function changeTemplate( id )
{

  var o;


  if( id == null )
  {
    o = $('#version_design_template_id');
    id = o.val();
  }

  var uri = "<%= get_local_host %>/partials/version_settings/" + id + "?version_id=" + <%= @version.id %>;


  $.get( uri, function(data, status)
    {
        $('#values_container').html( data );
    } );
}

</script>




<h1>New Version</h1>

<%=
form_for @version, html: { multipart: true, :onsubmit => 'return validate();'  } do |form|
%>

  <div class='container' style='width: 100%;'>

    <div style='flex:1'>

      <div class="form-group">
        <label for="version[name]">Name</label>
        <input type='text' name='version[name]'></input>
      </div>

      <div class="form-group">
        <label for="version[output_folder_path]">Output Folder</label>
        <%= @root_folder + "/" %> <input type='text' id='version_output_folder_path' name='version[output_folder_path]'></input>
      </div>

      <div class="form-group">
        <label for="runai">Run Illustrator?</label>
        <input type='checkbox' name='runai' id='runai'></input>
      </div>


        <div class="form-group">
          <label for="version_design_template_id">Template:</label>
          <select class="form-control" style='width: 200px;' name='version[design_template_id]' id='version_design_template_id' onchange='changeTemplate();'>
            <option value="" disabled selected>Select a Template</option>

<%          @design_templates.each { |t|

              if ( t.id == @design_template_id.to_i ) then
                selected = true
%>
                <script> changeTemplate( <%= t.id.to_s %> ); </script>
<%
              else
                selected = false
              end
%>
              <option <%= if selected then 'selected="selected"' end %> value='<%= t.id.to_s %>'><%= t.name %></option>
<%          }
%>
          </select>
        </div>

        <a class='btn btn-default' href='<%= get_local_host %>/versions'>Cancel</a>
        <button class='btn btn-default' id='create' onclick='create_version();'>Create</button>


    </div>


    <div id='values_container' style='flex:1'></div>
    <input name='version_data' id='version_data' style='display:none;'></input>


<%
  end %>

  </div>
